!function(n){"function"==typeof define&&define.amd?define(n):n()}(function(){"use strict";function n(i,t,r=(()=>{})){if(0===(i=e.isString(i)?i:e.castArray(i)).length)return r([]),[];const u=e.assign({$take:i.length,$ignore:[],$include:()=>({}),$keyName:"@",$value:"@"},t);i=s(i,u.$take);var $=e.omitBy(u,(n,e)=>"$"===e[0]);return l(i,(i,r,s)=>{let d=c(i,r);if(e.isFunction(t.$value)){for(let n in t.$value(i,r))$[n]="";i=t.$value(i,r)}u.$value=d(t.$value,i);u.$keyName=d(t.$keyName,r);let y=a(u.$value,u.$include,r);u.$value=y;for(let n in u.$include(i,r))$[n]="";u.$value=f(u.$value,u.$ignore);if(!e.isEmpty(u.$ignore)&&0==e.keys($).length)for(let n in u.$value)$[n]="";if(!e.isObject(u.$value))return void s(u.$value,u.$keyName);l($,(i,t,r)=>{function a(u){if(!e.isObject(i)){if(""!==i){let n=c(f,t);u=n(i,f)}return void r(u)}s?n(u,i,n=>{n=e.isArray(u)?e.toArray(n):n[0];r(n)}):(e.isArray(u)&&(u=[u]),n(u,i,n=>{e.isString(u)&&(n=[n.join("")]);n=n[0];if(e.isArray(f)){let i=e.toArray(n);0!==i.length&&(n=i)}r(n)}))}console.log(t);let f=o(u.$value[t])(i);console.log(f);let s=n.middlewares[t];s?e.isArray(s)?s.pass(t,f,n=>{a(n[0])}):(n.middlewares=s,a(f)):a(f)},n=>{s(n,u.$keyName)},"@"!==u.$keyName?{}:[])},r,"@"!==u.$keyName?{}:[])}const e=require("lodash"),i=n=>{console.log(new Error(`Qreal [WARN] : ${n}`))},t=n=>e.isString(n)&&""!==n,r=(n,i=" ",t)=>{const r=e.fill(Array(t-n.length),i);return[...r,...n]},u=n=>{if(n)return!1;if(!e.isNumber(n))return!0;return!1},o=n=>e.isFunction(n)?n:()=>n,a=(n,t,r)=>{t=o(t)(n||{},r||0);t||i(`$include return "${t}"`);e.isString(n)&&(e.isArray(t)&&(t=t.join("")),e.isEmpty(t)&&(t=""),n+=e.toString(t));e.isObject(n)&&(n=e.merge(n,t));return n},c=e.curry((n,i,r,a)=>{let c=o(r)(n,i);t(c)?(c=e.get(n,e.trimStart(c,"@"),null),u(c)&&(c=a)):c=a;return c}),f=(n,i)=>{if(e.isArray(n))return e.pullAll(n,i);if(e.isObject(n))return e.omit(n,i);return n},s=(n,i)=>{let t=e.take(e.castArray(i),2);let[u,o]=r(t,0,2);u=-1!==e.findIndex(n,u)?e.findIndex(n,u):u;o=u+o+t.length-1;return e.slice(n,u,o)},l=(n,e,i,t=[])=>{function r(){let i=a[o],r=n[i];e(r,i,(n,e)=>{o+=1;t[e||i]=n;u()})}function u(){o>a.length-1?i(t):r()}var o=0;let a=Object.keys(n);r();return t};n.middlewares={},n.use=function(i,t){Array.prototype.pass=function(i,t,r){l(n.middlewares[i],(n,i,r)=>{l(e.castArray(t),(e,i,t)=>{n(e,function(n){t(n)})},n=>{e.isArray(t)||(n=n[0]);r(n)})},r)},n.middlewares[i]?n.middlewares[i].push(t):e.set(n.middlewares,i,[t])},module.exports=n});
