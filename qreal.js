!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";function e(r,t){r=n.castArray(r);const u=n.assign({$take:r.length,$ignore:[],$include:()=>({}),$keyName:"@",$value:"@"},t);r=l(r,u.$take);var c=n.omitBy(u,(e,n)=>"$"===n[0]);return n.reduce(r,(r,l,f)=>{let d=o(l,f);if(n.isFunction(t.$value)){for(let e in t.$value(l,f))c[e]="";l=t.$value(l,f)}u.$value=d(t.$value,l);u.$keyName=d(t.$keyName,f);let $=a(u.$value,u.$include,f);u.$value=$;for(let e in u.$include(l,f))c[e]="";$||i("$include return undefined");u.$value=s(u.$value,u.$ignore);if(!n.isEmpty(u.$ignore)&&0==n.keys(c).length)for(let e in u.$value)c[e]="";n.isObject(u.$value)&&(u.$value=n.mapValues(c,(r,t)=>{let a=u.$value[t];let o=e.middlewares[t];o&&(a=e.middlewares[t].pass(a));n.isUndefined(a)&&(n.isArray(u.$value)||i(`[ ${t} ] is undefined`));if(n.isObject(r)){let i=e([a],r)[0];o&&(i=e(a,r),n.isObject(a)&&!n.isArray(a)&&(i=i[0])),a=n.isArray(a)?n.toArray(i):i}return a}));r[u.$keyName]=u.$value;return r},"@"!==u.$keyName?{}:[])}var n=require("lodash");const i=e=>{console.log(new Error(`Qreal [WARN] : ${e}`))},r=e=>n.isString(e)&&""!==e,t=(e,i=" ",r)=>{const t=n.fill(Array(r-e.length),i);return[...t,...e]},u=e=>n.isFunction(e)?e:()=>e,a=(e,i,r)=>{i=u(i)(e,r);n.isString(e)?(n.isArray(i)&&(i=i.join("")),n.isEmpty(i)&&(i=""),e+=n.toString(i)):e=n.merge(e,i);return e},o=n.curry((e,i,t,a)=>{let o=u(t)(e,i);r(o)?(o=n.get(e,n.trimStart(o,"@"),null))||(o=a):o=a;return o}),s=(e,i)=>{if(n.isArray(e))return n.pullAll(e,i);if(n.isObject(e))return n.omit(e,i);return e},l=(e,i)=>{let r=n.take(n.castArray(i),2);let[u,a]=t(r,0,2);u=-1!==n.findIndex(e,u)?n.findIndex(e,u):u;a=u+a+r.length-1;return n.slice(e,u,a)};e.middlewares={},e.use=function(n,r){var t=[r];t.middlewares=e.middlewares[n],t.pass=function(e){for(let r of this){const t=r(e);if("object"!=typeof t){i(`middleware of ${n} should return Object`);break}e=t}return e},e.middlewares[n]?e.middlewares[n].push(r):e.middlewares[n]=t},module.exports=e});
