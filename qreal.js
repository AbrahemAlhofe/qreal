!function(n){"function"==typeof define&&define.amd?define(n):n()}(function(){"use strict";function n(r,u,$=(()=>{})){if(0===(r=i.isString(r)?r:i.castArray(r)).length)return $([]),[];const y=i.assign({$take:r.length,$ignore:[],$include:()=>({}),$keyName:"@",$value:"@"},u);r=s(r,y.$take);var d=i.omitBy(y,(n,i)=>"$"===i[0]);return l(r,(r,s,$)=>{let m=c(r,s);if(i.isFunction(u.$value)){for(let n in u.$value(r,s))d[n]="";r=u.$value(r,s)}y.$value=m(u.$value,r);y.$keyName=m(u.$keyName,s);let v=a(y.$value,y.$include,s);y.$value=v;for(let n in y.$include(r,s))d[n]="";y.$value=f(y.$value,y.$ignore);if(!i.isEmpty(y.$ignore)&&0==i.keys(d).length)for(let n in y.$value)d[n]="";if(!i.isObject(y.$value))return void $(y.$value,y.$keyName);l(d,(r,u,a)=>{function f(o){if(!i.isObject(r)||i.isArray(r)){if(t(r)){let n=c(s,u);o=n(r,o)}return void a(o)}l?n(o,r,n=>{n=i.isArray(o)?i.toArray(n):n[0];a(n)}):(i.isArray(o)&&!i.isObject(o[0])&&(r.$value&&e(`use shorthand of $value method in ${u} query`),o=[o]),n(o,r,n=>{i.isString(o)&&(n=[n.join("")]);i.isArray(s)||i.isObject(s[0])||(n=n[0]);if(i.isArray(s)&&!i.isObject(s[0])){let e=i.toArray(n[0]);0!==e.length&&(n=e)}a(n)}))}let s=y.$value[u];let l=n.middlewares[u];l?i.isArray(l)?l.pass(u,s,y.$value,r,n=>{f(n[0])}):(n.middlewares=l,f(s)):f(o(s)(r))},n=>{$(n,y.$keyName)},"@"!==y.$keyName?{}:[])},$,"@"!==y.$keyName?{}:[])}const i=require("lodash"),e=n=>{console.log(new Error(`Qreal [WARN] : ${n}`))},t=n=>i.isString(n)&&""!==n,r=(n,e=" ",t)=>{const r=i.fill(Array(t-n.length),e);return[...r,...n]},u=n=>{if(n)return!1;if(!i.isNumber(n))return!0;return!1},o=n=>i.isFunction(n)?n:()=>n,a=(n,t,r)=>{t=o(t)(n||{},r||0);t||e(`$include return "${t}"`);i.isString(n)&&(i.isArray(t)&&(t=t.join("")),i.isEmpty(t)&&(t=""),n+=i.toString(t));i.isObject(n)&&(n=i.merge(n,t));return n},c=i.curry((n,e,r,a)=>{let c=o(r)(n,e);t(c)?(c=i.get(n,i.trimStart(c,"@"),null),u(c)&&(c=a)):c=a;return c}),f=(n,e)=>{if(i.isArray(n))return i.pullAll(n,e);if(i.isObject(n))return i.omit(n,e);return n},s=(n,e)=>{let t=i.take(i.castArray(e),2);let[u,o]=r(t,0,2);u=-1!==i.findIndex(n,u)?i.findIndex(n,u):u;o=u+o+t.length-1;return i.slice(n,u,o)},l=(n,i,e,t=[])=>{function r(){let e=a[o],r=n[e];i(r,e,(n,i)=>{o+=1;t[i||e]=n;u()})}function u(){o>a.length-1?e(t):r()}var o=0;let a=Object.keys(n);r();return t};n.middlewares={},n.use=function(e,t){Array.prototype.pass=function(e,t,r,u,o){l(n.middlewares[e],(n,e,o)=>{l(i.castArray(t),(i,e,t)=>{n(i,r,function(n){t(n)},u)},n=>{i.isArray(t)||(n=n[0]);o(n)})},o)},n.middlewares[e]?n.middlewares[e].push(t):i.set(n.middlewares,e,[t])},module.exports=n});
