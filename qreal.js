!function(n){"function"==typeof define&&define.amd?define(n):n()}(function(){"use strict";function n(e,t,r=(()=>{})){if(0===(e=i.isString(e)?e:i.castArray(e)).length)return r([]),[];const u=i.assign({$take:e.length,$ignore:[],$include:()=>({}),$keyName:"@",$value:"@"},t);e=s(e,u.$take);var y=i.omitBy(u,(n,i)=>"$"===i[0]);return l(e,(e,r,s)=>{let $=f(e,r);if(i.isFunction(t.$value)){for(let n in t.$value(e,r))y[n]="";e=t.$value(e,r)}u.$value=$(t.$value,e);u.$keyName=$(t.$keyName,r);let d=a(u.$value,u.$include,r);u.$value=d;for(let n in u.$include(e,r))y[n]="";u.$value=c(u.$value,u.$ignore);if(!i.isEmpty(u.$ignore)&&0==i.keys(y).length)for(let n in u.$value)y[n]="";if(!i.isObject(u.$value))return void s(u.$value,u.$keyName);l(y,(e,t,r)=>{function a(u){if(!i.isObject(e)||i.isArray(e)){if(""!==e){let n=f(c,t);u=n(e,c)}return void r(u)}s?n(u,e,n=>{n=i.isArray(u)?i.toArray(n):n[0];r(n)}):(i.isArray(u)&&(u=[u]),n(u,e,n=>{i.isString(u)&&(n=[n.join("")]);n=n[0];if(i.isArray(c)){let e=i.toArray(n);0!==e.length&&(n=e)}r(n)}))}let c=o(u.$value[t])(e);let s=n.middlewares[t];s?i.isArray(s)?s.pass(t,c,n=>{a(n[0])}):(n.middlewares=s,a(c)):a(c)},n=>{s(n,u.$keyName)},"@"!==u.$keyName?{}:[])},r,"@"!==u.$keyName?{}:[])}const i=require("lodash"),e=n=>{console.log(new Error(`Qreal [WARN] : ${n}`))},t=n=>i.isString(n)&&""!==n,r=(n,e=" ",t)=>{const r=i.fill(Array(t-n.length),e);return[...r,...n]},u=n=>{if(n)return!1;if(!i.isNumber(n))return!0;return!1},o=n=>i.isFunction(n)?n:()=>n,a=(n,t,r)=>{t=o(t)(n||{},r||0);t||e(`$include return "${t}"`);i.isString(n)&&(i.isArray(t)&&(t=t.join("")),i.isEmpty(t)&&(t=""),n+=i.toString(t));i.isObject(n)&&(n=i.merge(n,t));return n},f=i.curry((n,e,r,a)=>{let f=o(r)(n,e);t(f)?(f=i.get(n,i.trimStart(f,"@"),null),u(f)&&(f=a)):f=a;return f}),c=(n,e)=>{if(i.isArray(n))return i.pullAll(n,e);if(i.isObject(n))return i.omit(n,e);return n},s=(n,e)=>{let t=i.take(i.castArray(e),2);let[u,o]=r(t,0,2);u=-1!==i.findIndex(n,u)?i.findIndex(n,u):u;o=u+o+t.length-1;return i.slice(n,u,o)},l=(n,i,e,t=[])=>{function r(){let e=a[o],r=n[e];i(r,e,(n,i)=>{o+=1;t[i||e]=n;u()})}function u(){o>a.length-1?e(t):r()}var o=0;let a=Object.keys(n);r();return t};n.middlewares={},n.use=function(e,t){Array.prototype.pass=function(e,t,r){l(n.middlewares[e],(n,e,r)=>{l(i.castArray(t),(i,e,t)=>{n(i,function(n){t(n)})},n=>{i.isArray(t)||(n=n[0]);r(n)})},r)},n.middlewares[e]?n.middlewares[e].push(t):i.set(n.middlewares,e,[t])},module.exports=n});
